<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOISE.IO - Party MVP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <meta name="theme-color" content="#a57bff" />
  <meta name="color-scheme" content="light" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="icon" href="/assets/favicon.png" type="image/png" />
  <link rel="manifest" href="/manifest.webmanifest" />
</head>
<body>
  <div id="app" class="fade-in">
    <header class="app-header card">
      <div class="title">
        <h1>NOISE.IO</h1>
        <div id="roomInfo" class="room-info"></div>
      </div>

  <!-- Global music control (bottom-left) -->
  <div id="musicCtrl" class="music-ctrl">
    <div class="music-buttons">
      <button id="musicMuteBtn" class="music-btn" aria-label="Couper la musique" title="Couper la musique">🔊</button>
      <button id="musicBtn" class="music-btn" aria-label="Musique" title="Réglage musique">🎵</button>
    </div>
    <div id="musicPanel" class="music-panel hidden">
      <input id="musicSlider" type="range" min="0" max="1" step="0.05" value="0.4" />
      <span id="musicValue" class="music-value">40%</span>
    </div>
  </div>
      <div class="row header-row">
        <div class="header-left">
          <button id="openAvatarBtn" class="avatar-chip" aria-label="Changer d’avatar">
            <img id="avatarChipImg" src="/assets/avatars/skin1.jpg" alt="Avatar" />
          </button>
          <span id="greetName" class="greet-name">Salut 👋</span>
        </div>
        <div class="header-right">
          <div id="echoWallet" class="echo-wallet">
            <img src="/assets/ui/echos.png" alt="Échos" class="coin" />
            <span id="echoBalance">0</span>
          </div>
        </div>
      </div>
      <div id="statusBanner" class="status-banner hidden">Prêt ?</div>
    </header>

    

    <main class="main">
      <section id="home" class="home-screen">
        <div class="home-inner">
          <!-- Logo & ambiance -->
          <div class="home-hero" aria-hidden="false">
            <img class="home-logo" src="/assets/logo noise.png" alt="Noise.io" />
          </div>

          <!-- Bloc Profil joueur -->
          <div class="avatar-wrap">
            <button id="homeAvatarBtn" class="home-avatar-btn" aria-label="Changer d’avatar">
              <img id="homeAvatarImg" class="home-avatar-img" src="/assets/avatars/skin1.jpg" alt="Avatar" />
            </button>
          </div>
          <div class="nick-row">
            <span class="nick-icon">👤</span>
            <input id="nickname" class="nick-input" placeholder="Pseudo" maxlength="15" />
          </div>
          <div id="nickHint" class="nick-hint hidden">Choisis un pseudo entre 3 et 15 caractères.</div>

          <!-- Bloc Partie entre amis -->
          <h3 class="friends-title">Partie entre amis</h3>

          <!-- Rejoindre une partie -->
          <div class="join-row">
            <input id="joinCode" class="join-input" placeholder="Entrer un code de partie (ex : M4HU)" maxlength="6" inputmode="latin" autocapitalize="characters" />
            <button id="joinSubmit" class="btn arrow" aria-label="Rejoindre">→</button>
          </div>

          <!-- Créer une partie -->
          <button id="createGame" class="btn cta-yellow">CRÉER UNE PARTIE ENTRE AMIS</button>
        </div>
        <!-- Recorder guesses floating area -->
        <div id="guessesArea" class="guesses-area"></div>
      </section>

      <!-- Shop screen -->
      <section id="shop" class="card narrow hidden shop-screen">
        <div class="row between shop-top">
          <button id="shopBackBtn" class="btn ghost">← Accueil</button>
          <div id="shopTimer" class="shop-timer">🕒 Nouveau stock dans --:--:--</div>
        </div>
        <div id="shopGrid" class="shop-grid"></div>
        <div class="card inner chest-card">
          <div class="row between">
            <h3>🎁 Coffre gratuit du jour</h3>
            <div id="chestStatus" class="muted">Disponible</div>
          </div>
          <button id="openChestBtn" class="btn primary">Ouvrir</button>
        </div>
      </section>
      
      <!-- Avatar selector modal -->
      <div id="avatarModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="avatarTitle">
        <div class="modal-card card">
          <div class="row between">
            <h3 id="avatarTitle">Choisis ton avatar</h3>
            <button id="closeAvatarBtn" class="btn small">Fermer</button>
          </div>
          <div id="avatarGrid" class="avatar-grid"></div>
        </div>
      </div>

      

      <section id="lobby" class="hidden lobby-screen">
        <div class="lobby-inner">
          <!-- Header (floating on violet) -->
          <div class="lobby-header">
            <button id="leaveBtn" class="icon-btn" aria-label="Quitter">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path d="M10 20v-6h4v6h5a1 1 0 0 0 1-1V9.667a1 1 0 0 0-.357-.76l-7-5.833a1 1 0 0 0-1.286 0l-7 5.833A1 1 0 0 0 4 9.667V19a1 1 0 0 0 1 1h5z" fill="currentColor"/></svg>
            </button>
            <div class="lobby-title">Le Salon (<span id="roomCode"></span>)</div>
            <button id="copyCodeBtn" class="icon-btn" aria-label="Copier le code">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M7 17a5 5 0 0 1 0-10h4v2H7a3 3 0 0 0 0 6h4v2H7zm6-8V7h4a5 5 0 0 1 0 10h-4v-2h4a3 3 0 0 0 0-6h-4zm-5 3h8v2H8v-2z"/>
              </svg>
            </button>
          </div>

          <!-- Theme block (floating card) -->
          <div class="theme-card">
            <div class="theme-left">🌍</div>
            <div class="theme-right">
              <div class="theme-title">Thème Général</div>
              <button id="changeThemeBtn" class="btn theme-btn">Changer de thème</button>
            </div>
          </div>

          <!-- Tabs (floating bar) -->
          <div class="tabs-wrap">
            <div class="tabs-pill">
              <div class="pill-indicator"></div>
              <button id="tabPlayers" class="pill active">Joueurs</button>
              <button id="tabMessages" class="pill">Messages</button>
            </div>
          </div>

          <!-- Panels (floating content) -->
          <div class="lobby-panels">
            <div id="panelPlayers" class="lobby-panel active">
              <ul id="playerList" class="players-list"></ul>
            </div>
            <div id="panelMessages" class="lobby-panel">
              <div id="chatLogLobby" class="chat-log"></div>
              <div id="emojiBarLobby" class="emoji-bar" aria-label="Emoji bar">
                <button class="emoji">👋</button>
                <button class="emoji">😆</button>
                <button class="emoji">😂</button>
                <button class="emoji">❤️</button>
                <button class="emoji">🥳</button>
                <button class="emoji">🔥</button>
              </div>
              <div class="input-row">
                <input id="chatInputLobby" class="input" placeholder="Envoyer un message" enterkeyhint="send" />
                <button id="sendMessageLobby" class="btn send-blue" aria-label="Envoyer">›</button>
              </div>
            </div>
          </div>

          <!-- Footer CTA (floating) -->
          <div class="lobby-footer">
            <button id="startGame" class="btn cta-yellow">LANCER LA PARTIE</button>
            <div id="waitingHostMsg" class="hint muted hidden">⏳ En attente de l’hôte…</div>
          </div>
        </div>
      </section>

      <section id="round" class="hidden">
        <div class="recorder-surface">
          <div id="recBanner" class="rec-banner hidden">
            <div class="rec-title">À ton tour, <span id="yourTurnTitle">—</span> !</div>
            <div class="rec-sub">Fais deviner ton mot sans parler 🎭</div>
          </div>
        </div>
        <div class="round-inner">
          <div id="recorderBubbles" class="recorder-bubbles" aria-hidden="true"></div>
          <div class="round-header">
            <div class="round-top">
              <div id="turnLabel" class="turn-label">Manche en cours</div>
              <div id="recorderChip" class="recorder-chip hidden">🎤 —</div>
              <span id="timerBadge" class="timer-badge hidden">00:20</span>
            </div>
            <div class="timer-wrap">
              <div id="timeBar" class="timebar"></div>
              <div id="timer" class="timer-text">00:00</div>
            </div>
          </div>

          <div id="wave" class="wave hidden" aria-hidden="true">
            <div class="ring r1"></div>
            <div class="ring r2"></div>
            <div class="ring r3"></div>
            <div class="center-dot">🔊</div>
          </div>

          <div id="recorderView" class="recorder-view hidden">
            <!-- Word card -->
            <div id="wordCard" class="word-card">
              <img id="wordImage" class="word-image" alt="Mot à bruiter" />
              <div id="wordTitle" class="word-title">—</div>
              <button id="newWord" class="btn theme-btn small">Changer de mot</button>
            </div>

            <!-- Recording zone -->
            <div id="recordZone" class="record-zone">
              <button id="recordButton" class="record-btn" aria-label="Maintenir pour enregistrer">
                <span class="mic-icon">🎤</span>
              </button>
              <div class="rec-hint">Enregistre jusqu’à 5 secondes maximum</div>
              <div id="roundTimer" class="round-timer">00:30</div>
            </div>

            <div id="recorderWait" class="recorder-wait hidden">En attente des devineurs…</div>
          </div>

          

          <div id="waitingView" class="waiting-view hidden">
            <div id="waitingMsg" class="waiting-msg">🎤 Attends quelques secondes…</div>
            <div class="loader-pulse"></div>
          </div>

          <div id="guessView" class="guess-view">
            <div id="guesserTimer" class="guesser-timer hidden">
              <span id="guesserTimerBadge" class="timer-badge">00:20</span>
            </div>
            <div id="enableSoundWrap" class="enable-sound hidden">
              <button id="enableSoundBtn" class="btn">Activer le son</button>
            </div>
            <div class="panels">
              <div id="panelChat" class="panel active card inner">
                <h3>Chat</h3>
                <div id="chatLog" class="log"></div>
                <div id="chatRow" class="row">
                  <input id="chatInput" class="input" placeholder="Votre proposition..." enterkeyhint="send" />
                  <button id="sendChatBtn" class="btn" disabled>Envoyer</button>
                </div>
              </div>
              <div id="panelScores" class="panel card inner">
                <h3>Scoreboard</h3>
                <ul id="scores" class="scores"></ul>
                <h3>Replays</h3>
                <div id="replays"></div>
              </div>
            </div>
            <nav id="bottomTabs" class="bottom-tabs hidden">
              <button id="tabChat" class="tab active">💬 Chat</button>
              <button id="tabScores" class="tab">🏆 Scores</button>
            </nav>
          </div>
        </div>
      </section>

      <section id="ended" class="ended-screen hidden">
        <div class="ended-inner">
          <div id="endConfetti" class="confetti-layer" aria-hidden="true"></div>
          <h2 id="endedTitle" class="ended-title">Bravo à tous pour cette cacophonie légendaire ! 🎉</h2>

          <div class="podium-card">
            <div id="podium" class="podium">
              <div class="slot silver bounce-in">
                <div class="medal">🥈</div>
                <div class="name" id="podiumSilverName">—</div>
                <div class="score" id="podiumSilverScore">0 pts</div>
              </div>
              <div class="slot gold bounce-in">
                <div class="halo"></div>
                <div class="medal">🥇</div>
                <div class="name" id="podiumGoldName">—</div>
                <div class="score" id="podiumGoldScore">0 pts</div>
              </div>
              <div class="slot bronze bounce-in">
                <div class="medal">🥉</div>
                <div class="name" id="podiumBronzeName">—</div>
                <div class="score" id="podiumBronzeScore">0 pts</div>
              </div>
            </div>

            <div class="others-list">
              <ul id="leaderboardFull" class="leaderboard"></ul>
            </div>
          </div>

          <div class="replays-section">
            <h3 class="replays-title">Les bruits cultes de la partie 🔊</h3>
            <div id="finalReplays" class="replays-list hscroll"></div>
          </div>

          <div class="end-actions">
            <button id="restartBtn" class="btn end-cta replay">🎮 Rejouer une partie</button>
            <button id="backHomeBtn" class="btn end-cta home">🏠 Revenir à l’accueil</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Overlays: recorder bubbles + winner toast -->
  <div id="bubblesLayer" class="bubbles-layer hidden" aria-hidden="true"></div>
  <div id="winnerToast" class="winner-toast hidden" aria-live="polite" role="status"></div>

  <!-- Inter-round transition overlay (5s) -->
  <div id="transitionOverlay" class="transition-overlay hidden" aria-live="polite" role="status">
    <div class="overlay-inner">
      <div id="trConfetti" class="confetti-layer" aria-hidden="true"></div>
      <h2 id="trTitle" class="tr-title pop-in">—</h2>
      <div class="card word-reveal">
        <img id="trWordImage" class="word-image" alt="Mot révélé" />
        <div id="trWordText" class="word-title">—</div>
      </div>
      <ul id="trResultsList" class="results-list"></ul>
      <div id="trCountdown" class="card countdown">Prochaine manche dans <span id="trCountdownValue">5</span> secondes</div>
    </div>
  </div>

  <script src="/client.js?v=imgwords-v6" type="module"></script>
</body>
</html>
