/* ============ SoundMaker (Round) ============ */
.recorder-surface { background: linear-gradient(180deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.08) 100%); padding: 8px 0 0; }
.round-inner { width: 100%; max-width: 560px; margin: 0 auto; padding: 0 12px 16px; background: transparent; box-shadow: none; }
.rec-banner { text-align: center; color: #fff; margin: 6px 0 10px; }
.rec-title { font-weight: 800; letter-spacing: .2px; }
.rec-sub { opacity: .95; font-weight: 600; }

.word-card { width: min(92%, 520px); margin: 10px auto; background: #fff; border-radius: 16px; box-shadow: var(--shadow); padding: 14px; display: grid; justify-items: center; gap: 8px; }
.word-image { width: 100%; max-width: 360px; height: clamp(140px, 34vw, 220px); object-fit: contain; border-radius: 12px; background: #F7F5FF; }
.word-image.fade-in { animation: fadeIn 260ms ease-out; }
.word-title { font-weight: 900; color: #2D1855; font-size: clamp(20px, 5vw, 28px); }
.word-card .btn.small { padding: 8px 12px; border-radius: 12px; }

.record-zone { display: grid; justify-items: center; gap: 10px; margin: 10px 0 8px; }
.record-btn { width: clamp(84px, 24vw, 128px); height: clamp(84px, 24vw, 128px); border-radius: 999px; border: 6px solid rgba(255,255,255,0.9); background: #5A9EFF; display: grid; place-items: center; box-shadow: 0 14px 28px rgba(0,0,0,.18); transition: transform 120ms ease, background-color 120ms ease, box-shadow 120ms ease; }
.record-btn .mic-icon { font-size: clamp(28px, 6vw, 42px); filter: drop-shadow(0 2px 0 rgba(0,0,0,.1)); }
.record-btn:active { transform: translateY(1px) scale(0.98); }
body.recording .record-btn, .record-btn.active { background: #FF4F4F; box-shadow: 0 10px 24px rgba(255,79,79,.35); }
.rec-hint { color: #f1f1ff; font-weight: 600; opacity: .95; }
.round-timer { background: rgba(45,24,85,0.85); color: #fff; font-weight: 800; padding: 6px 12px; border-radius: 999px; box-shadow: 0 6px 14px rgba(0,0,0,.12); }

/* Align wave with record zone */
#wave { margin: 8px auto 0; }

/* Recorder guesses area (placeholder container) */
.guesses-area { position: relative; }

/* Room code uppercase for header */
#roomCode { text-transform: uppercase; letter-spacing: .5px; }
.role-recorder .timer-badge, .role-recorder .timer-wrap { display: none !important; }
/* Hide legacy header timer badge in round; we show only #roundTimer in record zone */
#round .timer-badge { display: none !important; }
* { box-sizing: border-box; }

/* Role-based ambiance */
body.role-recorder { background: radial-gradient(1200px 1200px at 10% 0%, #fff1ec 0%, #ffe9f3 35%, #fff7fb 65%); }
body.role-guesser { background: radial-gradient(1200px 1200px at 10% 0%, #f2f6ff 0%, #eef3ff 35%, #faf7ff 65%); }

/* Recorder view */
.recorder-view { text-align: center; margin-bottom: 10px; }
.secret-title { font-weight: 700; color: var(--muted); letter-spacing: .3px; }
.secret-word { font-size: 28px; font-weight: 700; margin-top: 4px; }
.recorder-wait { margin-top: 8px; color: var(--muted); }

/* Waiting view */
.waiting-view { text-align: center; margin-bottom: 10px; }
.waiting-msg { font-weight: 600; margin-bottom: 10px; }
.loader-pulse { width: 14px; height: 14px; margin: 0 auto; border-radius: 50%; background: var(--primary); animation: pulseDot 900ms ease-in-out infinite; opacity: .9; }
@keyframes pulseDot { 0% { transform: scale(1); opacity: .9; } 50% { transform: scale(1.3); opacity: .6; } 100% { transform: scale(1); opacity: .9; } }

/* Guess view root (acts like app screen) */
.guess-view { display: block; }

/* Enable sound prompt */
.enable-sound { display: grid; place-items: center; margin-bottom: 8px; }
.enable-sound .btn { background: #fffdf5; }

/* Wave effect during audio playback */
.wave { position: relative; height: 110px; margin-bottom: 8px; display: grid; place-items: center; }
.wave .center-dot { position: absolute; z-index: 2; font-size: 18px; }
.wave .ring { position: absolute; width: 24px; height: 24px; border-radius: 999px; opacity: 0; animation: ringPulse 1600ms ease-out infinite; }
.wave .r1 { animation-delay: 0ms; }
.wave .r2 { animation-delay: 300ms; }
.wave .r3 { animation-delay: 600ms; }
@keyframes ringPulse { 0% { opacity: .6; transform: scale(1); } 70% { opacity: .25; } 100% { opacity: 0; transform: scale(6); } }
/* Role-tinted rings */
body.role-guesser .wave .ring { background: radial-gradient(circle, rgba(165,123,255,0.45) 0%, rgba(165,123,255,0.15) 60%, rgba(165,123,255,0.0) 70%); }
body.role-recorder .wave .ring { background: radial-gradient(circle, rgba(255,138,101,0.45) 0%, rgba(255,138,101,0.15) 60%, rgba(255,138,101,0.0) 70%); }

/* (old ended-screen styles removed) */

.players.modern { list-style: none; padding: 0; margin: 0; display: grid; gap: 6px; }
.players.modern li { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; padding: 10px 12px; background: #fff; border-radius: 16px; box-shadow: var(--shadow); animation: fadeIn 280ms ease-out; }
.players.modern .avatar { width: 36px; height: 36px; border-radius: 999px; display: grid; place-items: center; color: #fff; font-weight: 700; }
.players.modern .avatar-img { width: 36px; height: 36px; border-radius: 999px; display: block; object-fit: cover; box-shadow: 0 2px 6px rgba(0,0,0,.08); }
.players.modern .name { font-weight: 700; }
.players.modern .host { font-size: 12px; color: var(--muted); margin-left: 4px; }
.players.modern .status { width: 10px; height: 10px; border-radius: 999px; background: #69db7c; box-shadow: 0 0 0 3px rgba(105,219,124,.18); }

.lobby-screen { background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,.85) 100%); }
.code-bar { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 12px; }
.code-bar .code { font-weight: 700; font-size: 18px; }
.code-actions { display: flex; gap: 8px; }
.players-card { margin-top: 6px; }
.lobby-actions { display: grid; gap: 12px; margin-top: 12px; }
.hint.center { text-align: center; }
.hint.muted { color: var(--muted); }

.pop-in { animation: popIn 420ms ease-out; }

/* Modal */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: grid; place-items: center; z-index: 50; }
.modal.hidden { display: none !important; }
.modal .modal-card { width: min(520px, 92vw); }
.avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
@media (min-width: 520px) { .avatar-grid { grid-template-columns: repeat(6, 1fr); } }
.avatar-option { display: grid; place-items: center; }
.avatar-option button { width: 72px; height: 72px; padding: 0; border-radius: 999px; border: 3px solid transparent; background: #fff; box-shadow: var(--shadow); cursor: pointer; }
.avatar-option button.selected { border-color: #cba8ff; box-shadow: 0 0 0 6px rgba(165,123,255,0.15), var(--shadow); }
.avatar-option img { width: 100%; height: 100%; object-fit: cover; border-radius: 999px; display: block; }

/* Sticky restart button and scrollable replays */
.restart-wrap { position: sticky; bottom: 0; background: linear-gradient(180deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.85) 40%, rgba(255,255,255,1) 100%); padding-top: 8px; border-radius: 0 0 16px 16px; }
.restart-wrap .btn { width: 100%; padding: 16px 20px; font-size: 16px; }
.replays-list, #replays { display: grid; gap: 12px; max-height: 42vh; overflow: auto; padding: 6px 2px; grid-template-columns: 1fr; }

/* Replay cards */
.replay-card { background: #fff; border-radius: 16px; box-shadow: var(--shadow); padding: 10px; display: grid; gap: 8px; text-align: left; }
.replay-word { font-weight: 800; letter-spacing: .2px; }
.replay-meta { color: var(--muted); font-size: 12px; }
.replay-controls { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; }
.play-btn { width: 42px; height: 42px; border-radius: 999px; display: grid; place-items: center; border: none; background: linear-gradient(135deg, var(--primary), #cba8ff); color: #fff; box-shadow: 0 8px 18px rgba(165,123,255,.35); cursor: pointer; }
.duration { font-size: 12px; color: var(--muted); }
.progress { position: relative; height: 8px; background: #f1e9ff; border-radius: 999px; overflow: hidden; }
.progress > div { position: absolute; left: 0; top: 0; bottom: 0; width: 0%; background: linear-gradient(90deg, var(--primary), #ff6b6b); }
.bars { display: inline-flex; gap: 2px; align-items: flex-end; height: 10px; }
.bars span { width: 2px; background: var(--primary); opacity: .5; animation: barDance 900ms ease-in-out infinite; }
.replay-card.playing .bars span:nth-child(1) { height: 6px; animation-delay: 0ms; }
.replay-card.playing .bars span:nth-child(2) { height: 9px; animation-delay: 120ms; }
.replay-card.playing .bars span:nth-child(3) { height: 5px; animation-delay: 240ms; }
.replay-card.playing .bars span:nth-child(4) { height: 8px; animation-delay: 360ms; }
@keyframes barDance { 0%,100% { transform: scaleY(.6); } 50% { transform: scaleY(1.2); } }

@media (min-width: 720px) {
  .replays-list, #replays { grid-template-columns: 1fr 1fr; }
}

@media (max-width: 480px) {
  .podium { grid-template-columns: 1fr 1.2fr 1fr; }
  .replays-list { max-height: 48vh; }
}

/* Mobile-first portrait tweaks */
@media (max-width: 480px) {
  body { padding-bottom: env(safe-area-inset-bottom); }
  #app { padding: 12px; }
  .app-header { padding: 12px; }
  .card { padding: 12px; }
  .btn { padding: 14px 20px; font-size: 16px; }
  .input { padding: 14px 16px; font-size: 16px; }
  .log { height: 200px; }
  .row { gap: 8px; }
  .round-header { flex-direction: column; align-items: stretch; gap: 8px; }
  .timer-wrap { height: 18px; }
  .bottom-tabs { position: sticky; }
}

.input { padding: 12px 14px; border: 2px solid #eee; border-radius: 16px; background: #fff; outline: none; width: 100%; box-shadow: inset 0 1px 1px rgba(0,0,0,0.02); }
.input:focus { border-color: #e0d6ff; box-shadow: 0 0 0 4px rgba(165,123,255,0.15); }

.btn { padding: 12px 18px; border: none; border-radius: 999px; background: #fff; color: var(--text); font-weight: 600; cursor: pointer; box-shadow: var(--shadow); transform: translateY(0); transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease; }
.btn:hover { transform: translateY(-1px); box-shadow: 0 12px 24px rgba(0,0,0,0.10); }
.btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
.btn.primary { background: linear-gradient(90deg, var(--primary), #cba8ff); color: white; }
.btn.ghost { background: transparent; color: var(--primary); border: 2px solid rgba(165,123,255,.6); }
.btn.small { padding: 8px 10px; font-size: 13px; }
.btn.danger { background: #ffe3e3; color: #c92a2a; }
.btn.danger.ghost { background: transparent; border: 2px solid #ffc9c9; color: #e03131; }

.players, .scores { list-style: none; padding-left: 0; margin: 10px 0; }
.players li, .scores li { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 12px; }
.scores li.recorder, .players li.recorder { outline: 3px solid rgba(165,123,255,0.4); background: #fbf8ff; }
.dot { width: 10px; height: 10px; border-radius: 999px; box-shadow: inset 0 0 0 2px rgba(255,255,255,0.6); }
.mic { font-size: 14px; }

.log { height: 260px; overflow: auto; background: #fff; border: 2px solid #f3f0ff; border-radius: 16px; padding: 12px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.03); }
.msg { margin: 6px 0; padding: 8px 10px; border-radius: 14px; background: #f9f9fb; }
.msg.alt { background: #ffffff; }
.small { color: var(--muted); font-size: 12px; }
.hint { color: var(--muted); font-size: 12px; margin-top: 8px; }

audio { display: block; margin: 6px 0; width: 100%; }

.round-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 12px; }
.round-top { display: flex; align-items: center; gap: 8px; }
.turn-label { font-weight: 700; padding: 8px 12px; background: #fbf8ff; border-radius: 12px; }
.recorder-chip { padding: 6px 10px; border-radius: 999px; background: #fff0f5; color: #b00053; font-weight: 600; box-shadow: var(--shadow); }
.timer-badge { display: inline-flex; align-items: center; justify-content: center; margin-left: 8px; padding: 2px 8px; height: 22px; border-radius: 8px; font-weight: 800; font-size: 12px; letter-spacing: .3px; background: #eaf7ea; color: #2b8a3e; box-shadow: 0 1px 2px rgba(0,0,0,.06) inset; }
.timer-badge.warn { background: #fff3cd; color: #b8860b; }
.timer-badge.danger { background: #ffe3e3; color: #c92a2a; }
.guesser-timer { display: flex; justify-content: flex-end; margin: 6px 8px 8px; }
.timer-wrap { position: relative; flex: 1; height: 16px; background: #f1e9ff; border-radius: 999px; overflow: hidden; }
.timebar { position: absolute; inset: 0; width: 100%; background: linear-gradient(90deg, var(--primary), #ff6b6b); transform-origin: left; transition: width 0.2s linear, background 180ms linear; }
.timer-text { position: absolute; inset: 0; display: grid; place-items: center; font-variant-numeric: tabular-nums; font-size: 12px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.25); transition: transform 120ms ease, color 120ms ease, filter 120ms ease; }
/* Chrono immersive states */
.timer-wrap.ok .timebar { background: linear-gradient(90deg, #69db7c, #a0e57a); }
.timer-wrap.warn .timebar { background: linear-gradient(90deg, #ffb74d, #ff9800); }
.timer-wrap.danger .timebar { background: linear-gradient(90deg, #ff6b6b, #ff3b3b); }
.timer-wrap.focus .timer-text { transform: scale(1.05); filter: drop-shadow(0 2px 6px rgba(255,0,0,.15)); }
.timer-text.pulse { animation: timerPulse 220ms ease-out; }
@keyframes timerPulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
.timer-text.blink { animation: timerBlink 1000ms steps(2, jump-none) infinite; }
@keyframes timerBlink { 0% { opacity: 1; } 50% { opacity: .5; } 100% { opacity: 1; } }
.timer-wrap.halo::after { content: ""; position: absolute; inset: -6px; border-radius: 999px; background: radial-gradient(circle, rgba(255,0,0,.16) 0, rgba(255,0,0,0) 65%); pointer-events: none; animation: haloFlash 260ms ease-out; }
@keyframes haloFlash { from { opacity: 0; } to { opacity: 1; } }
/* Card beat in last 5s */
#round .card.narrow.card-beat { animation: cardBeat 1000ms ease-in-out infinite; }
@keyframes cardBeat { 0% { transform: scale(1); } 30% { transform: scale(1.01); } 60% { transform: scale(1); } 100% { transform: scale(1); } }

.recorder-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 12px; }
/* Recorder primary actions */
#startRecBtn.btn { padding: 16px 22px; font-size: 16px; }
#stopRecBtn.btn { padding: 16px 18px; font-size: 16px; }
#newWordInRoundBtn.btn, #newWordBtn.btn { padding: 10px 12px; font-size: 13px; }
.recorder-view .secret { display: grid; gap: 6px; align-items: center; justify-items: center; margin-bottom: 10px; }
.recorder-view .secret-title { color: var(--muted); font-weight: 600; }
.recorder-view .secret-word, .secret-word { font-size: 26px; font-weight: 800; letter-spacing: .3px; }
.secret-word.pop { animation: wordPop 360ms ease-out; }
@keyframes wordPop { 0% { transform: scale(.9); opacity: .6; } 100% { transform: scale(1); opacity: 1; } }

/* Waiting/guess views */
.waiting-view { display: grid; place-items: center; gap: 10px; min-height: 120px; }
.loader-pulse { width: 42px; height: 42px; border-radius: 999px; background: radial-gradient(circle, rgba(165,123,255,.8), rgba(165,123,255,.2)); animation: pulse 1200ms ease-in-out infinite; filter: blur(.2px); }
@keyframes pulse { 0% { transform: scale(1); opacity: .7; } 50% { transform: scale(1.08); opacity: 1; } 100% { transform: scale(1); opacity: .7; } }
.guess-view .info { text-align: center; color: var(--muted); }

/* Wave rings already exist; ensure visible stacking */
#wave { position: relative; margin: 8px auto; height: 60px; display: grid; place-items: center; }
.wave .center-dot { position: relative; z-index: 2; }

/* Panels & tabs */
.panels { display: grid; gap: 12px; }
.panel { display: none; }
.panel.active { display: block; }
.bottom-tabs { position: sticky; bottom: 0; left: 0; right: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: transparent; padding-top: 8px; padding-bottom: calc(8px + env(safe-area-inset-bottom)); }
.bottom-tabs .btn { padding: 10px 14px; border-radius: 999px; border: none; background: #eee; cursor: pointer; font-weight: 600; }
.bottom-tabs .btn.active { background: linear-gradient(90deg, var(--primary), #cba8ff); color: #fff; }

/* Sticky chat input within panel for thumb reachability */
#chatRow { position: sticky; bottom: 0; background: var(--card); padding-top: 8px; }

/* Transitions and effects */
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.flash { animation: flashBg 600ms ease-out; }
@keyframes flashBg { 0% { background-color: #fff; } 10% { background-color: #ffe6ea; } 100% { background-color: transparent; } }

.timeup { animation: pulse 800ms ease-in-out 2; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

:root {
  --bg: #faf7ff;
  --card: #ffffff;
  --text: #333333;
  --muted: #7a7a7a;
  --primary: #a57bff; /* pastel violet */
  --accent: #ff8a65; /* pastel orange */
  --danger: #ff4d6d;
  --radius: 20px;
  --shadow: 0 10px 30px rgba(0,0,0,0.07);
}

html, body { height: 100%; }
body { margin: 0; font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Apple Color Emoji','Segoe UI Emoji'; color: var(--text); background: var(--bg); }
/* App-wide gradient background for landing */
body:has(#home.landing) { background: linear-gradient(180deg, #fcb3c9 0%, #e8b5ff 45%, #d7c6ff 70%, #f0e6ff 100%); }
/* Role-tinted page ambiance */
body.role-recorder { background: linear-gradient(180deg, #fff1e8 0%, #ffe3d7 40%, #ffe9e3 100%); }
body.role-guesser { background: linear-gradient(180deg, #f6f0ff 0%, #efe8ff 40%, #e8eaff 100%); }
.landing .main { max-width: 960px; margin: 12px auto; padding: 0 12px; }
.landing.card { background: transparent; box-shadow: none; padding: 0; }
.landing .landing-inner { max-width: 420px; margin: 0 auto; padding: 28px 16px 24px; text-align: center; }
.landing .brand .logo { font-size: 34px; margin: 0; letter-spacing: .5px; }
.landing .brand .tag { margin-top: 6px; color: #3b3b3b; opacity: .9; }
.landing .hero { position: relative; height: 220px; display: grid; place-items: center; margin: 10px auto 18px; }
.landing .hero .halo { position: absolute; width: 220px; height: 140px; background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.75), rgba(255,255,255,.25)); filter: blur(8px); border-radius: 50%; transform: translateY(16px); }
.landing .hero .mic { position: relative; font-size: 56px; z-index: 1; animation: float 3.2s ease-in-out infinite; }
.landing .hero .bubble { position: absolute; font-size: 24px; opacity: .9; filter: drop-shadow(0 6px 14px rgba(0,0,0,.08)); animation: bob 4.2s ease-in-out infinite; }
.landing .hero .b1 { left: 18%; top: 18%; animation-delay: 0ms; }
.landing .hero .b2 { right: 22%; top: 28%; animation-delay: 300ms; }
.landing .hero .b3 { left: 28%; bottom: 10%; animation-delay: 600ms; }
@keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
@keyframes bob { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
.landing .actions { display: grid; gap: 12px; margin-top: 8px; }
.btn.big { padding: 16px 18px; font-size: 16px; }
.btn.ghost { background: transparent; color: var(--primary); border: 2px solid rgba(165,123,255,.6); }
.join-row { gap: 8px; justify-content: center; }
.join-row .input { text-transform: uppercase; max-width: 220px; text-align: center; }

/* Home screen (UX refresh) */
body:has(#home.home-screen) { background: url('/assets/background.png') center / cover no-repeat fixed; }
body:has(#home.home-screen) .app-header { display: none !important; }
.home-mode { background: url('/assets/background.png') center / cover no-repeat fixed !important; }
.home-mode .app-header { display: none !important; }
.home-screen { background: transparent; box-shadow: none; padding-top: 6px; }
.home-inner { width: 100%; max-width: 480px; margin: 0 auto; padding: 16px 16px calc(24px + env(safe-area-inset-bottom)); min-height: calc(100vh - 40px); display: grid; grid-auto-rows: max-content; justify-items: center; gap: 12px; }
.home-hero { text-align: center; margin-top: 10px; margin-bottom: 4px; position: relative; }
.home-logo { width: clamp(180px, 45vw, 260px); height: auto; filter: drop-shadow(0 4px 14px rgba(0,0,0,.18)); }
.emoji-cloud { color: #fff; opacity: .9; font-size: 18px; letter-spacing: 6px; margin-top: 6px; animation: floaty 6s ease-in-out infinite; }
@keyframes floaty { 0% { transform: translateY(0); } 50% { transform: translateY(-6px); } 100% { transform: translateY(0); } }

.home-card { display: contents; }
.profile-card { display: contents; }
.avatar-wrap { display: grid; place-items: center; margin: 6px 0 8px; }
.home-avatar-btn { width: clamp(96px, 28vw, 128px); height: clamp(96px, 28vw, 128px); padding: 0; border-radius: 999px; border: 6px solid #fff; background: #f7f7ff; box-shadow: 0 10px 28px rgba(0,0,0,.16); overflow: hidden; cursor: pointer; }
.home-avatar-img { width: 100%; height: 100%; object-fit: cover; display: block; border-radius: 999px; }
.nick-row { width: 100%; display: grid; grid-template-columns: 28px 1fr; align-items: center; gap: 8px; background: #fff; border-radius: 14px; padding: 10px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.nick-icon { color: #4B5EFF; font-size: 16px; display: inline-block; }
.nick-input { border: none; outline: none; font-weight: 600; color: #233; font-size: 16px; background: transparent; width: 100%; }
.nick-input::placeholder { color: #99a; }
.nick-hint { width: 100%; margin-top: 4px; font-size: 12px; color: #ffe0e0; text-align: center; }

.friends-title { text-align: center; color: #fff; font-weight: 800; margin: 12px 0 6px; letter-spacing: .2px; }
.join-row { width: 100%; display: grid; grid-template-columns: 1fr 48px; gap: 10px; align-items: center; }
.join-input { height: clamp(44px, 6.5vw, 56px); border-radius: 16px; border: none; padding: 0 14px; background: #fff; font-weight: 600; text-transform: uppercase; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.join-input::placeholder { color: #99a; text-transform: none; }
.btn.arrow { height: clamp(44px, 6.5vw, 56px); border-radius: 16px; background: #BFA7FF; color: #2d0066; font-weight: 800; box-shadow: 0 4px 10px rgba(0,0,0,0.12); }
.btn.arrow:active { transform: translateY(1px); }

.btn.cta-yellow { width: 100%; margin-top: 8px; height: clamp(50px, 7.5vw, 64px); border-radius: 16px; background: #FAD64A; color: #3a236b; font-weight: 900; letter-spacing: .4px; box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08), 0 8px 18px rgba(0,0,0,0.18); transition: transform 120ms ease, box-shadow 120ms ease; }
.btn.cta-yellow:hover { transform: translateY(-1px); box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08), 0 10px 22px rgba(0,0,0,0.22); }
.btn.cta-yellow:active { transform: translateY(0); box-shadow: inset 0 0 0 rgba(0,0,0,0.08), 0 6px 16px rgba(0,0,0,0.16); }

/* Lobby screen (UX refresh) */
.lobby-mode { background: url('/assets/background.png') center / cover no-repeat fixed !important; }
.lobby-screen { background: transparent; }
.lobby-inner { width: 100%; max-width: 560px; margin: 0 auto; padding: 16px 16px calc(24px + env(safe-area-inset-bottom)); display: grid; gap: 14px; }
.lobby-header { display: grid; grid-template-columns: 40px 1fr 40px; align-items: center; gap: 8px; color: #fff; font-weight: 800; }
.icon-btn { width: 36px; height: 36px; display: grid; place-items: center; border-radius: 10px; border: none; background: transparent; color: #fff; cursor: pointer; }
.icon-btn:active { transform: translateY(1px); }
.lobby-title { text-align: center; font-weight: 800; letter-spacing: .3px; }

.theme-card { display: grid; grid-template-columns: 52px 1fr; align-items: center; gap: 10px; background: #ffffff; border-radius: 16px; padding: 12px; box-shadow: var(--shadow); }
.theme-left { width: 52px; height: 52px; border-radius: 12px; display: grid; place-items: center; background: #efe6ff; font-size: 24px; }
.theme-right { display: grid; gap: 6px; align-items: center; }
.theme-title { font-weight: 800; color: #2D1855; }
.theme-btn { background: #4B5EFF; color: #fff; font-weight: 900; border-radius: 14px; box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08), 0 6px 14px rgba(0,0,0,0.14); }
.theme-btn:hover { transform: translateY(-1px); box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08), 0 8px 18px rgba(0,0,0,0.18); }
.theme-btn:active { transform: translateY(0); box-shadow: inset 0 0 0 rgba(0,0,0,0.08), 0 6px 12px rgba(0,0,0,0.12); }

.tabs-wrap { display: grid; place-items: center; margin: 6px 0; }
.tabs-pill { position: relative; background: #E8D9FF; border-radius: 999px; padding: 4px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px; width: 100%; max-width: 420px; }
.tabs-pill .pill-indicator { position: absolute; top: 4px; left: 4px; width: calc(50% - 4px); height: calc(100% - 8px); border-radius: 999px; background: #FAD64A; box-shadow: 0 4px 12px rgba(0,0,0,0.12); transition: transform 220ms ease; }
.tabs-pill.ind-messages .pill-indicator { transform: translateX(100%); }
.pill { position: relative; z-index: 1; border-radius: 999px; border: none; background: transparent; padding: 10px 14px; font-weight: 800; color: #5b4a8a; cursor: pointer; }
.pill.active { color: #2D1855; }

.lobby-panels { display: grid; gap: 10px; }
.lobby-panel { display: none; }
.lobby-panel.active { display: block; }

/* Players list */
.players-list { list-style: none; padding: 0; margin: 0; display: grid; gap: 10px; }
.player-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; background: #ffffff; border-radius: 16px; padding: 10px 12px; box-shadow: var(--shadow); }
.pi-avatar { width: 42px; height: 42px; border-radius: 999px; overflow: hidden; border: 3px solid #fff; box-shadow: 0 6px 14px rgba(0,0,0,.12); display: grid; place-items: center; }
.pi-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; border-radius: 999px; }
.pi-fallback { width: 100%; height: 100%; border-radius: 999px; display: grid; place-items: center; color: #fff; font-weight: 800; }
.pi-name { font-weight: 700; letter-spacing: .2px; }
.pi-right { display: inline-flex; gap: 8px; align-items: center; }
.badge.host { background: #F45D5D; color: #fff; padding: 4px 8px; border-radius: 999px; font-weight: 800; font-size: 12px; }

/* Lobby chat */
.chat-log { min-height: 18vh; max-height: 36vh; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; background: #fff; border-radius: 16px; padding: 12px; box-shadow: inset 0 1px 3px rgba(0,0,0,.04); }
.emoji-bar { display: grid; grid-auto-flow: column; gap: 8px; justify-content: start; margin: 8px 0; }
.emoji-bar .emoji { border: none; background: #fff; border-radius: 10px; box-shadow: var(--shadow); padding: 6px 8px; cursor: pointer; }
.input-row { display: grid; grid-template-columns: 1fr 50px; gap: 8px; align-items: center; }
.btn.send-blue { background: #BFA7FF; color: #2D1855; font-weight: 900; border-radius: 14px; }

.lobby-footer { position: sticky; bottom: 0; background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 40%, rgba(255,255,255,1) 100%); padding-top: 8px; border-radius: 0 0 16px 16px; }
.lobby-footer .btn { width: 100%; }

@media (min-width: 900px) {
  .landing .landing-inner { max-width: 520px; }
  .landing .hero { height: 260px; }
}

.main { min-height: calc(100vh - 120px); display: grid; place-items: center; padding: 8px 12px; }
.fade-in { animation: fadeIn 320ms ease-out; }
.hidden { display: none !important; }

.app-header { position: sticky; top: 8px; z-index: 10; display: flex; align-items: center; justify-content: space-between; margin: 12px 0 18px; border-radius: var(--radius); box-shadow: var(--shadow); }
.app-header .title { display: flex; flex-direction: column; gap: 4px; }
h1 { margin: 0; font-size: 24px; font-weight: 700; letter-spacing: 0.5px; }
.room-info { color: var(--muted); font-size: 13px; }

/* Echo wallet */
.echo-wallet { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: #fff; box-shadow: var(--shadow); font-weight: 700; }
.echo-wallet .coin { width: 18px; height: 18px; display: block; }

/* Header minimal on landing */
body:has(#home.landing) .app-header { position: fixed; top: 10px; left: 12px; right: 12px; background: transparent; box-shadow: none; margin: 0; padding: 0; }
body:has(#home.landing) .app-header.card { background: transparent; box-shadow: none; }
body:has(#home.landing) .app-header .title { display: none; }
body:has(#home.landing) #statusBanner { display: none; }
body:has(#home.landing) .header-row { width: 100%; display: flex; align-items: center; justify-content: space-between; }
body:has(#home.landing) .header-left { display: inline-flex; align-items: center; gap: 8px; }
body:has(#home.landing) .greet-name { font-weight: 700; background: rgba(255,255,255,0.9); padding: 6px 10px; border-radius: 999px; box-shadow: var(--shadow); }

/* Floating echo chip on home/* Bottom tabs */
.bottom-tabs { position: sticky; bottom: 8px; margin-top: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.tab { padding: 10px 14px; border-radius: 10px; background: #fff; box-shadow: var(--shadow); border: none; font-weight: 700; }
.tab.active { background: linear-gradient(90deg, var(--primary), var(--accent)); color: white; }

/* Shop screen */
.shop-screen { background: linear-gradient(180deg, #f7f0ff, #ffeefe); }
.shop-top { align-items: center; margin-bottom: 10px; }
.shop-timer { font-weight: 700; color: #6b5fc3; }
.shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 10px 0 16px; }
.shop-card { position: relative; padding: 12px; border-radius: 16px; background: #fff; box-shadow: var(--shadow); display: flex; flex-direction: column; align-items: center; gap: 8px; overflow: hidden; }
.shop-card .img { width: 100%; aspect-ratio: 1/1; border-radius: 12px; background: #faf7ff; display: grid; place-items: center; position: relative; }
.shop-card .img img { width: 86%; height: 86%; object-fit: contain; display: block; }
.shop-card .name { font-weight: 700; font-size: 14px; }
.shop-card .price { font-weight: 800; }
.shop-card .buy-btn { width: 100%; border: none; padding: 10px 12px; border-radius: 10px; font-weight: 700; cursor: pointer; }
.shop-card .buy-btn:disabled { cursor: not-allowed; opacity: 0.6; }
.shop-card.owned .buy-btn { background: #e6f7e6; color: #2b8a3e; }
.halo { position: absolute; inset: -20%; opacity: 0.35; filter: blur(14px); border-radius: 50%; pointer-events: none; }
.rarity-common { box-shadow: inset 0 0 0 2px #b6f2c2; }
.rarity-common .halo { background: radial-gradient(circle, rgba(120,220,160,0.7), rgba(120,220,160,0)); }
.rarity-rare { box-shadow: inset 0 0 0 2px #9ad7ff; }
.rarity-rare .halo { background: radial-gradient(circle, rgba(80,180,255,0.7), rgba(80,180,255,0)); }
.rarity-epic { box-shadow: inset 0 0 0 2px #d1a4ff; }
.rarity-epic .halo { background: radial-gradient(circle, rgba(165,123,255,0.7), rgba(165,123,255,0)); }
.rarity-legendary { box-shadow: inset 0 0 0 2px #ffd166; }
.rarity-legendary .halo { background: radial-gradient(circle, rgba(255,209,102,0.8), rgba(255,209,102,0)); animation: pulse 3s ease-in-out infinite; }
@keyframes pulse { 0%,100% { opacity: .35 } 50% { opacity: .6 } }

.chest-card { margin-top: 8px; background: #fff7fb; }
.chest-card .btn { width: 100%; }

/* Header avatar chip */
.avatar-chip { width: 36px; height: 36px; padding: 0; margin-left: 8px; border: none; border-radius: 999px; background: #fff; display: grid; place-items: center; box-shadow: var(--shadow); cursor: pointer; }
.avatar-chip img { width: 100%; height: 100%; border-radius: 999px; object-fit: cover; display: block; }

.status-banner { padding: 10px 16px; border-radius: 999px; background: linear-gradient(90deg, var(--primary), var(--accent)); color: white; font-weight: 600; box-shadow: var(--shadow); }
.status-banner.info { background: linear-gradient(90deg, var(--primary), var(--accent)); }
.status-banner.success { background: linear-gradient(90deg, #37b24d, #69db7c); }
.status-banner.danger { background: linear-gradient(90deg, #ff6b6b, #ff8787); }

.card { background: var(--card); padding: 16px; border-radius: var(--radius); box-shadow: var(--shadow); }
.card.narrow { max-width: 420px; margin-left: auto; margin-right: auto; }
.card.inner { border-radius: 16px; }
.center { text-align: center; }

/* Recorder bubbles overlay */
.bubbles-layer { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 60; }
.bubbles-layer .bubble { position: absolute; bottom: -20px; padding: 8px 12px; border-radius: 999px; color: #333; font-weight: 700; opacity: .85; backdrop-filter: blur(8px); will-change: transform, opacity; box-shadow: 0 8px 22px rgba(0,0,0,.08); }
.bubbles-layer .bubble.small { font-size: 12px; padding: 6px 10px; }
.bubbles-layer .bubble.big { font-size: 16px; padding: 10px 14px; }
.bubbles-layer .bubble.anim { animation: bubbleRise var(--dur,2600ms) cubic-bezier(.2,.8,.3,1) forwards; }
@keyframes bubbleRise { 0% { transform: translate3d(var(--dx,0px), 0, 0) scale(.98); opacity: .9; } 70% { transform: translate3d(calc(var(--dx,0px) * -1), -40vh, 0) scale(1); opacity: .9; } 100% { transform: translate3d(0, -60vh, 0) scale(1.02); opacity: 0; } }

/* ================= Transition Overlay (Inter-Round, 5s) ================ */
.transition-overlay { position: fixed; inset: 0; z-index: 80; display: grid; place-items: center; background: url('/assets/background.png') center / cover no-repeat fixed !important; }
.transition-overlay::before { content: none; }
.overlay-bg { background: url('/assets/background.png') center / cover no-repeat fixed !important; }
.transition-overlay.hidden { display: none !important; }
.transition-overlay .overlay-inner { width: min(560px, 92vw); display: grid; gap: 12px; justify-items: center; padding: 10px; }
.tr-title { color: #2D1855; font-weight: 900; letter-spacing: .4px; margin: 6px 0; text-align: center; animation: popIn 360ms ease-out both; }
.word-reveal { width: min(92%, 520px); display: grid; justify-items: center; gap: 8px; }
.results-list { list-style: none; padding: 0; margin: 6px 0; width: 100%; display: grid; gap: 6px; }
.result-row { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; background: #fff; border-radius: 14px; padding: 8px 10px; box-shadow: var(--shadow); }
.result-row .avatar { width: 32px; height: 32px; border-radius: 999px; color: #fff; font-weight: 800; display: grid; place-items: center; }
.result-row .name { font-weight: 700; }
.result-row .points { font-weight: 800; color: #2D1855; }
.countdown { background: #f3eaff; color: #2D1855; font-weight: 800; text-align: center; }

/* ================= End Screen (Final) ================= */
.ended-screen { position: relative; background: url('/assets/background.png') center / cover no-repeat fixed; min-height: calc(100vh - 120px); display: block; padding: 18px 12px 24px; width: 100%; justify-self: stretch; align-self: start; }
.ended-inner { width: 100%; max-width: 560px; margin: 0 auto; padding: 0 12px; display: grid; gap: 16px; }
.ended-inner, .podium-card, .replays-section, .end-actions { width: 100%; }
.ended-title { color: #fff; text-align: center; font-size: 22px; font-weight: 900; text-shadow: 0 2px 8px rgba(0,0,0,.12); }
.confetti-layer { pointer-events: none; }

.podium-card { background: rgba(255,255,255,.18); border: 1px solid rgba(255,255,255,.22); border-radius: 18px; box-shadow: 0 14px 38px rgba(68,36,125,.12); padding: 12px; backdrop-filter: blur(6px); width: 100%; }
.podium { display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: end; justify-items: center; justify-content: center; gap: 12px; }
.podium.cols-1 { grid-template-columns: 1fr; }
.podium.cols-2 { grid-template-columns: 1fr 1fr; }
.podium .slot { position: relative; background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.12)); border-radius: 16px; padding: 12px 10px; text-align: center; color: #2D1855; box-shadow: 0 10px 24px rgba(45,24,85,.12); width: 100%; max-width: 160px; display: grid; justify-items: center; }
.podium .slot.gold { transform: translateY(-6px); }
.podium .slot .medal { font-size: 26px; }
.podium .slot .name { font-weight: 900; margin-top: 6px; }
.podium .slot .score { font-weight: 800; opacity: .95; }
.podium .slot.gold .halo { position: absolute; inset: -6px -6px auto -6px; height: 54px; border-radius: 16px; background: radial-gradient(ellipse at center, rgba(250,214,74,.55), rgba(250,214,74,0)); filter: blur(8px); }
.bounce-in { animation: bounceIn .6s cubic-bezier(.2,.9,.2,1.2) both; }
@keyframes bounceIn { 0% { transform: translateY(12px) scale(.92); opacity: 0; } 60% { transform: translateY(-4px) scale(1.03); opacity: 1; } 100% { transform: translateY(0) scale(1); } }

.others-list { margin-top: 10px; }
.leaderboard { list-style: none; padding: 0; margin: 0; display: grid; gap: 8px; }
.lb-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; background: #fff; border-radius: 14px; padding: 10px 12px; box-shadow: 0 8px 22px rgba(0,0,0,.08); }
.lb-rank { font-weight: 900; color: #2D1855; min-width: 28px; text-align: center; }
.lb-avatar { width: 32px; height: 32px; border-radius: 999px; overflow: hidden; display: grid; place-items: center; color: #fff; font-weight: 900; }
.lb-avatar img { width: 32px; height: 32px; object-fit: cover; display: block; }
.lb-name { font-weight: 800; color: #2D1855; }
.lb-score { font-weight: 900; color: #2D1855; }

.replays-section { margin-top: 6px; }
.replays-title { color: #fff; font-weight: 900; margin: 4px 6px; text-shadow: 0 2px 6px rgba(0,0,0,.1); }
.replays-list { display: grid; gap: 10px; }
.replays-list.hscroll { --replay-gap: 12px; display: flex; overflow-x: auto; gap: var(--replay-gap); scroll-snap-type: x mandatory; padding-bottom: 6px; width: 100%; }
.replays-list.hscroll::-webkit-scrollbar { height: 6px; }
.replays-list.hscroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,.15); border-radius: 999px; }
.replay-card { flex: 0 0 calc((100% - (var(--replay-gap) * 2)) / 3); scroll-snap-align: start; display: grid; grid-template-columns: 56px 1fr auto; align-items: center; gap: 10px; background: #CBA5FF; border-radius: 12px; padding: 10px; box-shadow: 0 8px 22px rgba(45,24,85,.18); color: #2D1855; }
.replay-img { width: 56px; height: 56px; border-radius: 10px; object-fit: cover; background: #fff; }
.replay-word { font-weight: 900; }
.replay-meta { opacity: .9; font-weight: 700; font-size: 12px; }
.replay-controls { display: grid; }
.play-btn { width: 44px; height: 44px; border-radius: 999px; border: none; background: #fff; color: #6b3de8; font-weight: 900; font-size: 18px; box-shadow: 0 6px 16px rgba(0,0,0,.18); }
.replay-card.playing .play-btn { background: #6b3de8; color: #fff; }
.play-btn:active { transform: scale(.96); }

/* End-screen: replays vertical list (3 visibles, scroll-y) */
.ended-screen .replays-list.hscroll { display: grid !important; grid-auto-rows: auto; overflow-y: auto; overflow-x: hidden; max-height: clamp(220px, 36vh, 360px); gap: 10px; padding-bottom: 0; }
.ended-screen .replays-list.hscroll .replay-card { flex: none; width: 100%; min-width: 0; }

.end-actions { display: grid; gap: 10px; margin: 6px 0 12px; }
.end-cta { width: 100%; border: none; border-radius: 16px; font-weight: 900; padding: 14px 16px; box-shadow: 0 10px 28px rgba(0,0,0,.18); color: #2D1855; }
.end-cta.replay { background: #FAD64A; }
.end-cta.home { background: #A5D8FF; }

@media (min-width: 640px) {
  .ended-inner { max-width: 560px; }
  .podium { grid-template-columns: 1fr 1.2fr 1fr; }
  .podium .slot { max-width: 180px; }
}

@media (max-width: 380px) {
  .replay-card { grid-template-columns: 48px 1fr 40px; flex-basis: calc((100% - var(--replay-gap)) / 2); }
  .replay-img { width: 48px; height: 48px; }
  .play-btn { width: 40px; height: 40px; font-size: 16px; }
}
#trCountdownValue { display: inline-block; min-width: 20px; animation: scalePulse 800ms ease-in-out infinite; }
@keyframes scalePulse { 0% { transform: scale(1); } 50% { transform: scale(1.12); } 100% { transform: scale(1); } }
.recorder-bubbles { position: absolute; inset: 0; pointer-events: none; overflow: hidden; z-index: 5; }
.recorder-bubbles .bubble { position: absolute; bottom: 10px; padding: 8px 12px; border-radius: 999px; color: #333; font-weight: 700; opacity: .85; backdrop-filter: blur(8px); will-change: transform, opacity; box-shadow: 0 8px 22px rgba(0,0,0,.08); }
.recorder-bubbles .bubble.small { font-size: 12px; padding: 6px 10px; }
.recorder-bubbles .bubble.big { font-size: 16px; padding: 10px 14px; }
.recorder-bubbles .bubble.anim { animation: bubbleRise var(--dur,2600ms) cubic-bezier(.2,.8,.3,1) forwards; }

/* Winner toast */
.winner-toast { position: fixed; left: 50%; top: 36%; transform: translate(-50%, -50%) scale(.9); z-index: 40; background: rgba(255,255,255,.95); border-radius: 16px; padding: 14px 16px; box-shadow: 0 14px 40px rgba(0,0,0,.16); display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center; will-change: transform, opacity; }
.winner-toast.hidden { display: none !important; }
.winner-toast .avatar { width: 42px; height: 42px; border-radius: 999px; display: grid; place-items: center; color: #fff; font-weight: 800; }
.winner-toast .name { font-weight: 800; }
.winner-toast .sub { color: var(--muted); font-weight: 600; }
@keyframes toastIn { 0% { transform: translate(-50%, -50%) scale(.8); opacity: 0; } 60% { transform: translate(-50%, -50%) scale(1.08); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
@keyframes toastOut { from { opacity: 1; } to { opacity: 0; } }

.row { display: flex; gap: 10px; align-items: center; margin: 8px 0; }
.row.between { justify-content: space-between; }

.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
@media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }
.flash { animation: flashBg 600ms ease-out; }
@keyframes flashBg { 0% { background-color: #fff; } 10% { background-color: #ffe6ea; } 100% { background-color: transparent; } }

.timeup { animation: pulse 800ms ease-in-out 2; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
